---
title: リリースガイド
description: Arereパッケージをnpmに公開する方法
---

# リリースガイド

## 概要

Arereは**手動トリガーワークフロー**でリリースを行います。このアプローチには以下のメリットがあります：

- リリースタイミングの完全なコントロール
- モノレポのマルチパッケージ対応
- 安全のためのドライラン機能
- バージョン更新、CHANGELOG更新、npm公開の自動化

---

## リリース方法

### 方法1: Arereアクションを使用（推奨）

プロジェクトルートからリリースアクションを実行：

```bash
npx arere
# アクションリストから "release" を選択
```

対話形式で以下を案内します：

1. **パッケージ選択** - リリースするパッケージを複数選択
2. **バージョンタイプ** - patch、minor、majorから選択
3. **プレビュー** - 実行前にバージョン変更を確認
4. **ドライランオプション** - 実際に公開せずにテスト

### 方法2: GitHub CLIを使用

ワークフローを直接トリガー：

```bash
gh workflow run release.yml \
  -f packages=arere \
  -f version=patch \
  -f dry_run=false
```

### 方法3: GitHub Web UI

1. GitHubの **Actions** タブを開く
2. **Release** ワークフローを選択
3. **Run workflow** をクリック
4. 入力を埋めて実行

---

## ワークフロー入力

| 入力 | 説明 | 必須 | デフォルト |
|------|------|------|------------|
| `packages` | カンマ区切りのパッケージ名 | はい | `arere` |
| `version` | バージョンタイプ: `patch`, `minor`, `major` | はい | - |
| `dry_run` | 実際の公開をスキップ | いいえ | `false` |

### 例

**単一パッケージのリリース：**
```bash
gh workflow run release.yml -f packages=arere -f version=patch
```

**複数パッケージのリリース：**
```bash
gh workflow run release.yml -f packages=arere,arere-plugin-timer -f version=minor
```

**ドライラン（公開せずにテスト）：**
```bash
gh workflow run release.yml -f packages=arere -f version=patch -f dry_run=true
```

---

## ワークフローの処理内容

1. **Checkout** - 全履歴を含むリポジトリを取得
2. **Setup** - Node.jsとnpmレジストリを設定
3. **Test** - 全テストを実行
4. **Build** - 全パッケージをビルド
5. **Version Bump** - `package.json`のバージョンを更新
6. **Changelog** - `CHANGELOG.md`にリリースノートを追加
7. **Commit & Tag** - コミットとバージョンタグを作成
8. **Push** - 変更とタグをmainにプッシュ
9. **GitHub Release** - 自動生成ノート付きでリリースを作成
10. **npm Publish** - npmレジストリに公開

---

## リリースの監視

リリースをトリガーした後：

```bash
# ワークフローの進捗を監視
gh run watch

# 最近の実行を一覧表示
gh run list --workflow=release.yml

# ワークフローログを表示
gh run view <run-id> --log
```

---

## バージョニングガイドライン

[セマンティックバージョニング](https://semver.org/lang/ja/)に従います：

| タイプ | 使用するケース | 例 |
|--------|---------------|-----|
| `patch` | バグ修正、ドキュメント | `0.1.5` → `0.1.6` |
| `minor` | 新機能（後方互換性あり） | `0.1.5` → `0.2.0` |
| `major` | 破壊的変更 | `0.1.5` → `1.0.0` |

### プレリリースについて

プレリリース期間（v0.x.x）中は、minorバージョンでも破壊的変更が発生する可能性があります。v1.0.0以降は、セマンティックバージョニングを厳密に適用します。

---

## トラブルシューティング

### ワークフローが失敗した

1. ワークフローログを確認: `gh run view <run-id> --log`
2. よくある問題：
   - **テスト失敗** - リリース前にテストを修正
   - **ビルドエラー** - ローカルで`npm run build`が動作することを確認
   - **npm認証** - `NPM_TOKEN`シークレットが設定されているか確認

### 間違ったバージョンをリリースした

72時間以内であれば unpublish 可能：

```bash
npm unpublish arere@<version>
```

その後、正しいバージョンで修正して再リリース。

### まずドライラン

メジャーリリースでは必ずドライランを使用：

```bash
gh workflow run release.yml -f packages=arere -f version=major -f dry_run=true
```

---

## 必要なシークレット

ワークフローには以下のリポジトリシークレットが必要です：

| シークレット | 説明 |
|-------------|------|
| `NPM_TOKEN` | 公開権限を持つnpmアクセストークン |
| `GITHUB_TOKEN` | GitHub Actionsが自動提供 |

### NPM_TOKENの設定

1. [npmjs.com](https://www.npmjs.com/) → Access Tokensにアクセス
2. 新しい **Automation** トークンを作成
3. リポジトリに追加: Settings → Secrets → Actions → New secret

---

## セキュリティ

リリースワークフローはGitHubの権限システムで保護されています：

- **write権限**を持つユーザーのみが`workflow_dispatch`をトリガー可能
- 外部コントリビューターはリリースをトリガーできない
- 追加のセキュリティとして、承認者が必要な`environment`を設定可能
