---
title: 実践的な例
description: 実際の開発で使える複雑なアクションのサンプル
---

# 実践的な例

実際の開発ワークフローで使える、より複雑なアクションのサンプルです。

## プルリクエスト作成

GitHub CLI と連携して、プルリクエストを対話的に作成します。

```typescript
// ~/.arere/create-pr.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'create-pr',
  description: 'プルリクエストを作成',
  category: 'git',
  async run({ $, tui }) {
    // ブランチ一覧を取得
    const { stdout } = await $`git branch --format=%(refname:short)`
    const branches = stdout.split('\n').filter(Boolean)

    // マージ先ブランチを選択
    const targetBranch = await tui.prompt.select('マージ先:', branches)

    // PRタイトルと説明を入力
    const title = await tui.prompt.text('PRタイトル:', {
      validate: v => v.length > 0 || 'タイトルを入力してください',
    })

    const description = await tui.prompt.text('PR説明:', {
      placeholder: '変更内容を入力...',
    })

    // ドラフトか確認
    const isDraft = await tui.prompt.confirm('ドラフトPRとして作成しますか？', { defaultValue: false })

    // 確認
    tui.output.section('PR情報')
    tui.output.log(`  タイトル: ${title}`)
    tui.output.log(`  マージ先: ${targetBranch}`)
    tui.output.log(`  ドラフト: ${isDraft ? 'Yes' : 'No'}`)

    const confirmed = await tui.prompt.confirm('この内容でPRを作成しますか？', { defaultValue: true })

    if (!confirmed) {
      tui.output.warn('キャンセルしました')
      return
    }

    // PR作成
    const draftFlag = isDraft ? '--draft' : ''
    await $`gh pr create --title ${title} --body ${description} --base ${targetBranch} ${draftFlag}`

    tui.output.success('PRを作成しました')
  }
})
```

---

## デプロイアクション

進捗表示付きのデプロイアクションです。

```typescript
// ~/.arere/deploy.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'deploy',
  description: 'アプリケーションをデプロイ',
  category: 'deploy',
  async run({ $, tui, env }) {
    // 環境を選択
    const environment = await tui.prompt.select('デプロイ先:', [
      { label: 'ステージング', value: 'staging' },
      { label: '本番', value: 'production' },
    ])

    // 本番環境の場合は確認
    if (environment === 'production') {
      const confirmed = await tui.prompt.confirm(
        '本番環境にデプロイします。よろしいですか？',
        { defaultValue: false }
      )
      if (!confirmed) {
        tui.output.warn('キャンセルしました')
        return
      }
    }

    // スピナーで進捗表示
    const spinner = tui.control.spinner({ message: 'テスト実行中...' })
    spinner.start()

    // テスト実行
    const testResult = await $`npm test`
    if (testResult.exitCode !== 0) {
      spinner.fail('テストに失敗しました')
      return
    }
    spinner.update('ビルド中...')

    // ビルド
    const buildResult = await $`npm run build`
    if (buildResult.exitCode !== 0) {
      spinner.fail('ビルドに失敗しました')
      return
    }
    spinner.update('デプロイ中...')

    // デプロイ
    const deployResult = await $`npm run deploy:${environment}`
    if (deployResult.exitCode !== 0) {
      spinner.fail('デプロイに失敗しました')
      return
    }

    spinner.succeed(`${environment} へのデプロイが完了しました`)
  }
})
```

---

## バッチファイル処理

複数ファイルを処理する際にプログレスバーを使用します。

```typescript
// ~/.arere/batch-convert.ts
import { defineAction } from 'arere'
import { readdirSync } from 'node:fs'

export default defineAction({
  name: 'batch-convert',
  description: '画像を一括変換',
  async run({ $, tui }) {
    // 対象ファイルを取得
    const files = readdirSync('.').filter(f => f.endsWith('.png'))

    if (files.length === 0) {
      tui.output.warn('PNG ファイルがありません')
      return
    }

    // 出力形式を選択
    const format = await tui.prompt.select('出力形式:', [
      { label: 'JPEG', value: 'jpg' },
      { label: 'WebP', value: 'webp' },
    ])

    // プログレスバーで処理
    const progress = tui.control.progress({
      total: files.length,
      message: 'ファイルを変換中...'
    })

    progress.start()

    for (const file of files) {
      const output = file.replace('.png', `.${format}`)
      await $`convert ${file} ${output}`
      progress.increment()
    }

    progress.succeed(`${files.length} ファイルを変換しました`)
  }
})
```

---

## セットアップウィザード

複数ステップのフォームを使ったプロジェクトセットアップです。

```typescript
// ~/.arere/project-setup.ts
import { defineAction } from 'arere'
import { writeFileSync, mkdirSync } from 'node:fs'

export default defineAction({
  name: 'project-setup',
  description: 'プロジェクトをセットアップ',
  async run({ $, tui }) {
    // ステップフォームで設定を収集
    const config = await tui.prompt([
      {
        title: 'ステップ 1: 基本設定',
        fields: {
          name: { type: 'text', message: 'プロジェクト名' },
          version: { type: 'text', message: 'バージョン', defaultValue: '1.0.0' },
        },
      },
      {
        title: 'ステップ 2: 機能選択',
        fields: {
          typescript: { type: 'confirm', message: 'TypeScript を使用？' },
          eslint: { type: 'confirm', message: 'ESLint を使用？' },
          prettier: { type: 'confirm', message: 'Prettier を使用？' },
        },
      },
      {
        title: 'ステップ 3: パッケージマネージャー',
        fields: {
          packageManager: {
            type: 'select',
            message: 'パッケージマネージャー',
            choices: ['npm', 'yarn', 'pnpm'],
          },
        },
      },
    ])

    // ディレクトリ作成
    mkdirSync(config.name, { recursive: true })
    process.chdir(config.name)

    // スピナーで進捗表示
    const spinner = tui.control.spinner({ message: 'プロジェクトを初期化中...' })
    spinner.start()

    // package.json を作成
    const pkg = {
      name: config.name,
      version: config.version,
      type: 'module',
      scripts: {},
      dependencies: {},
      devDependencies: {},
    }
    writeFileSync('package.json', JSON.stringify(pkg, null, 2))

    // 依存関係をインストール
    const installCmd = config.packageManager === 'npm' ? 'install' : 'add'
    const devFlag = config.packageManager === 'npm' ? '--save-dev' : '-D'

    if (config.typescript) {
      spinner.update('TypeScript をインストール中...')
      const tsResult = await $`${config.packageManager} ${installCmd} ${devFlag} typescript @types/node`
      if (tsResult.exitCode !== 0) {
        spinner.fail('TypeScript のインストールに失敗しました')
        return
      }
    }

    if (config.eslint) {
      spinner.update('ESLint をインストール中...')
      const eslintResult = await $`${config.packageManager} ${installCmd} ${devFlag} eslint`
      if (eslintResult.exitCode !== 0) {
        spinner.fail('ESLint のインストールに失敗しました')
        return
      }
    }

    if (config.prettier) {
      spinner.update('Prettier をインストール中...')
      const prettierResult = await $`${config.packageManager} ${installCmd} ${devFlag} prettier`
      if (prettierResult.exitCode !== 0) {
        spinner.fail('Prettier のインストールに失敗しました')
        return
      }
    }

    spinner.succeed('プロジェクトを作成しました')
    tui.output.info(`\ncd ${config.name} でディレクトリに移動してください`)
  }
})
```

---

## データベースマイグレーション

確認付きのデータベースマイグレーションアクションです。

```typescript
// ~/.arere/db-migrate.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'db-migrate',
  description: 'データベースマイグレーション',
  category: 'database',
  async run({ $, tui, env }) {
    // 環境を確認
    const dbEnv = env.DATABASE_ENV || 'development'

    tui.output.info(`現在の環境: ${dbEnv}`)

    // 保留中のマイグレーションを確認
    const { stdout: pending } = await $`npm run db:migrate:status`
    tui.output.log(pending)

    // アクションを選択
    const action = await tui.prompt.select('実行するアクション:', [
      { label: 'マイグレーション実行', value: 'up' },
      { label: 'ロールバック', value: 'down' },
      { label: '状態確認', value: 'status' },
    ])

    if (action === 'status') {
      return
    }

    // 本番環境の場合は確認
    if (dbEnv === 'production') {
      const confirmed = await tui.prompt.confirm(
        `本番環境で ${action === 'up' ? 'マイグレーション' : 'ロールバック'} を実行します。よろしいですか？`,
        { defaultValue: false }
      )
      if (!confirmed) {
        tui.output.warn('キャンセルしました')
        return
      }
    }

    // 実行
    const spinner = tui.control.spinner({ message: '実行中...' })
    spinner.start()

    const result = await $`npm run db:migrate:${action}`
    if (result.exitCode !== 0) {
      spinner.fail('失敗しました')
      return
    }
    spinner.succeed('完了しました')
  }
})
```

---

## 次のステップ

- [クイックサンプル](./quick-examples) - シンプルなサンプル集
- [高度なテクニック](/guides/actions/advanced) - 進捗表示、CI/CD、i18n
