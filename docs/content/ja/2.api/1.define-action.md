---
title: defineAction API
description: アクションを定義するためのdefineAction関数のAPIリファレンス
---

# defineAction API

`defineAction` 関数を使ってアクションを定義します。

## インポート

```typescript
import { defineAction } from 'arere'
```

## 構文

```typescript
function defineAction(config: ActionDefinition): Action
```

## パラメータ

### `config: ActionDefinition`

アクションの設定オブジェクト：

| プロパティ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `name` | `string` | ✅ | アクションの一意な名前。英数字、ダッシュ、アンダースコアのみ使用可能 |
| `description` | `string \| (context: ActionContext) => string` | ✅ | アクションの説明（UI に表示される）。文字列または関数で指定可能 |
| `category` | `string` | ❌ | アクションのカテゴリ（グループ化に使用） |
| `tags` | `string[]` | ❌ | アクションのタグ（例: `['git', 'status']`）。UI で `[tag1,tag2]` 形式で表示される |
| `run` | `function` | ✅ | アクションの実行関数 |

### `run` 関数

```typescript
async run(context: ActionContext): Promise<void>
```

**Context オブジェクト**:

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| `tui` | `TuiAPI` | TUI API（`prompt`, `output`, `control` を含む） |
| `$` | `ShellExecutor` | シェルコマンド実行関数 |
| `t` | `Function` | 翻訳関数（i18n対応） |
| `cwd` | `string` | 現在の作業ディレクトリ |
| `env` | `Record<string, string \| undefined>` | 環境変数 |
| `config` | `ArereConfig` | アプリ設定へのアクセス |
| `pluginConfig` | `unknown` | プラグイン設定へのアクセス（プラグインアクションのみ） |
| `args` | `string[]` | CLI引数（`arere run <action> [args...]` 経由で利用可能） |

## 戻り値

`Action` オブジェクトを返します。

## 例

### 基本的な使い方

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'hello',
  description: 'Hello World を表示',
  async run({ tui }) {
    tui.output.log('Hello, World!')
  },
})
```

### プロンプトを使用

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'greet',
  description: '挨拶する',
  async run({ tui }) {
    const name = await tui.prompt.text('お名前は？', {
      placeholder: '山田太郎',
    })

    tui.output.success(`こんにちは、${name}さん！`)
  },
})
```

### シェルコマンド実行

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'git-status',
  description: 'Git のステータスを表示',
  category: 'git',
  async run({ tui, $ }) {
    const { stdout } = await $`git status --short`
    tui.output.log(stdout)
  },
})
```

### CLI引数

`arere run` 経由で実行する際、アクションはコマンドライン引数を受け取れます：

```bash
arere run deploy production --force
```

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'deploy',
  description: 'ターゲット環境にデプロイ',
  async run({ args, tui }) {
    // args = ['production', '--force']
    const target = args[0] || 'staging'
    const force = args.includes('--force')

    tui.output.info(`${target} にデプロイ中...`)
    if (force) {
      tui.output.warn('強制モードが有効です')
    }

    // ... デプロイ処理
    tui.output.success(`${target} にデプロイ完了！`)
  },
})
```

::callout{type="info"}
TUI（インタラクティブモード）から実行する場合、`args` は空の配列 `[]` になります。
::

### i18n対応（関数形式のdescription）

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'demo-plugin-i18n',
  description: ({ t }) => t('actions.demo.description', { ns: 'my-plugin' }),
  async run({ tui, t }) {
    const greeting = t('greeting', { ns: 'my-plugin' })
    tui.output.log(greeting)
  },
})
```

### 複雑な例

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'git-commit',
  description: 'Git コミットを作成',
  category: 'git',
  async run({ tui, $ }) {
    // ステージされたファイルを確認
    const { stdout } = await $`git diff --cached --name-only`
    const stagedFiles = stdout.split('\n').filter(Boolean)

    if (stagedFiles.length === 0) {
      tui.output.warn('ステージされたファイルがありません')
      return
    }

    tui.output.log('ステージされたファイル:')
    for (const file of stagedFiles) {
      tui.output.log(`  - ${file}`)
    }

    // コミットメッセージを入力
    const message = await tui.prompt.text('コミットメッセージ:', {
      validate: (value) => {
        if (value.length === 0) {
          return 'コミットメッセージを入力してください'
        }
        if (value.length < 3) {
          return 'コミットメッセージは3文字以上で入力してください'
        }
        return true
      },
    })

    // 確認
    const confirmed = await tui.prompt.confirm(
      `"${message}" でコミットしますか？`,
      { defaultValue: true }
    )

    if (!confirmed) {
      tui.output.warn('キャンセルしました')
      return
    }

    // コミット実行
    await $`git commit -m ${message}`
    tui.output.success('✓ コミット完了')
  },
})
```

## エラー処理

`defineAction` は以下の場合にエラーをスローします：

- `name` が未指定または空文字列
- `name` に無効な文字が含まれる（英数字、ダッシュ、アンダースコア以外）
- `description` が未指定または空文字列
- `run` が関数でない

```typescript
// ❌ エラー: name が無効
defineAction({
  name: 'hello world', // スペース不可
  description: 'Hello',
  run: async () => {},
})

// ❌ エラー: run が未指定
defineAction({
  name: 'hello',
  description: 'Hello',
})

// ✅ 正しい
defineAction({
  name: 'hello-world', // ダッシュはOK
  description: 'Hello World',
  run: async () => {},
})
```

## 型定義

```typescript
interface ActionDefinition {
  name: string
  description: string | ((context: ActionContext) => string)
  category?: string
  tags?: string[]
  run: (context: ActionContext) => Promise<void>
}

interface Action {
  meta: ActionMeta
  filePath: string
  location?: ActionLocation  // 'project' | 'global' | { plugin: string }
  run: (context: ActionContext) => Promise<void>
}

interface ActionContext {
  tui: TuiAPI
  $: ShellExecutor
  t: TranslationFunction
  cwd: string
  env: Record<string, string | undefined>
  config: ArereConfig
  pluginConfig?: unknown
  args: string[]
}
```

## 参照

- [prompt API](./prompt.md) - プロンプト関数の詳細
- [$ (shell) API](./shell.md) - シェル実行の詳細
- [アクション作成チュートリアル](/guides/actions/creating)
