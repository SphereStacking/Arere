---
title: Prompt API
description: ユーザーからの入力を受け取るためのプロンプトAPIリファレンス
---

# prompt API

ユーザーからの入力を受け取るためのプロンプトAPI。

## インポート

```typescript
import { text, select, confirm, multiSelect } from 'arere'
```

アクション内では `context.tui.prompt` から使用できます：

```typescript
export default defineAction({
  async run({ tui }) {
    const name = await tui.prompt.text('お名前は？')
  }
})
```

---

## text()

テキスト入力プロンプト。

### 構文

```typescript
async function text(message: string, options?: TextOptions): Promise<string>
```

### パラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `message` | `string` | ✅ | プロンプトメッセージ |
| `options` | `TextOptions` | ❌ | テキスト入力オプション |

#### `TextOptions`

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| `placeholder` | `string` | プレースホルダーテキスト |
| `defaultValue` | `string` | デフォルト値 |
| `validate` | `(value: string) => boolean \| string` | バリデーション関数。`true` で成功、文字列でエラーメッセージ |
| `prefix` | `string` | プレフィックス（固定文字列、読み取り専用） |
| `suffix` | `string` | サフィックス（固定文字列、読み取り専用） |
| `maxLength` | `number` | 最大文字数（prefix/suffixを含む） |
| `minLength` | `number` | 最小文字数（prefix/suffixを含む） |
| `pattern` | `RegExp` | 入力パターン制限（マッチしない文字をブロック） |
| `format` | `'lowercase' \| 'uppercase' \| 'trim' \| 'kebab-case' \| ((value: string) => string)` | フォーマット変換（Submit時に適用） |

### 戻り値

入力されたテキストを `Promise<string>` で返します。

### 例

```typescript
// 基本的な使い方
const name = await text('お名前は？')

// プレースホルダー付き
const email = await text('メールアドレス:', {
  placeholder: 'user@example.com',
})

// デフォルト値付き
const repo = await text('リポジトリ名:', {
  defaultValue: 'my-project',
})

// バリデーション付き
const port = await text('ポート番号:', {
  validate: (value) => {
    const num = Number.parseInt(value, 10)
    if (Number.isNaN(num)) {
      return 'ポート番号は数値で入力してください'
    }
    if (num < 1 || num > 65535) {
      return 'ポート番号は1-65535の範囲で入力してください'
    }
    return true
  },
})

// 複数のバリデーション
const password = await text('パスワード:', {
  validate: (value) => {
    if (value.length < 8) {
      return 'パスワードは8文字以上で入力してください'
    }
    if (!/[A-Z]/.test(value)) {
      return '大文字を含めてください'
    }
    if (!/[0-9]/.test(value)) {
      return '数字を含めてください'
    }
    return true
  },
})

// プレフィックス付き（プラグイン名）
const pluginName = await text('プラグイン名:', {
  prefix: 'arere-plugin-',
  placeholder: 'example',
})
// ユーザーが 'hello' と入力 → 返り値: 'arere-plugin-hello'

// サフィックス付き（メールアドレス）
const username = await text('ユーザー名:', {
  suffix: '@company.com',
  placeholder: 'john.doe',
})
// ユーザーが 'alice' と入力 → 返り値: 'alice@company.com'

// フォーマット変換（ケバブケース）
const slug = await text('URL スラッグ:', {
  format: 'kebab-case',
  placeholder: 'my-article',
})
// ユーザーが 'My Article Title' と入力 → 返り値: 'my-article-title'

// パターン制限（英数字とハイフンのみ）
const identifier = await text('識別子:', {
  pattern: /^[a-z0-9-]+$/,
  placeholder: 'my-id-123',
})
// ユーザーが大文字や記号を入力しても無視される

// 文字数制限
const shortText = await text('短いテキスト:', {
  maxLength: 20,
  minLength: 5,
})
// 最大20文字、最小5文字の入力を強制

// 組み合わせ（プラグイン名の完全な例）
const fullPluginName = await text('プラグイン名:', {
  prefix: 'arere-plugin-',
  format: 'kebab-case',
  pattern: /^[a-z0-9-]+$/,
  maxLength: 50,
  placeholder: 'example',
  validate: (value) => value.length > 0 || '入力してください',
})
// prefix自動付与 + kebab-case変換 + パターン制限 + 長さ制限
```

---

## select()

単一選択プロンプト。

### 構文

```typescript
async function select<T>(
  message: string,
  choices: T[] | SelectChoice<T>[]
): Promise<T>
```

### パラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `message` | `string` | ✅ | プロンプトメッセージ |
| `choices` | `T[]` or `SelectChoice<T>[]` | ✅ | 選択肢の配列 |

#### `SelectChoice<T>`

| プロパティ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `label` | `string` | ✅ | 表示ラベル |
| `value` | `T` | ✅ | 選択時の戻り値 |
| `description` | `string` | ❌ | 選択肢の説明 |

### 戻り値

選択された値を `Promise<T>` で返します。

### 例

```typescript
// 文字列の配列
const color = await select('色を選択:', ['red', 'blue', 'green'])
console.log(color) // 'red', 'blue', または 'green'

// 数値の配列
const port = await select('ポート:', [3000, 8080, 9000])
console.log(port) // 3000, 8080, または 9000

// SelectChoice オブジェクト
const env = await select('環境を選択:', [
  { label: '開発環境', value: 'development', description: 'ローカル開発用' },
  { label: 'ステージング', value: 'staging', description: 'テスト環境' },
  { label: '本番環境', value: 'production', description: '本番サーバー' },
])
console.log(env) // 'development', 'staging', または 'production'

// 動的な選択肢（Gitブランチ）
import { $ } from 'execa'

const { stdout } = await $`git branch --format=%(refname:short)`
const branches = stdout.split('\n').filter(Boolean)

const branch = await select('ブランチを選択:', branches)
await $`git switch ${branch}`

// オブジェクトの値を返す
interface Server {
  name: string
  url: string
}

const servers: Server[] = [
  { name: 'Development', url: 'http://localhost:3000' },
  { name: 'Staging', url: 'https://staging.example.com' },
  { name: 'Production', url: 'https://example.com' },
]

const server = await select('サーバーを選択:',
  servers.map(s => ({ label: s.name, value: s }))
)
console.log(server.url) // Server オブジェクトが返される
```

---

## confirm()

Yes/No 確認プロンプト。

### 構文

```typescript
async function confirm(
  message: string,
  defaultValue?: boolean
): Promise<boolean>
```

### パラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `message` | `string` | ✅ | 確認メッセージ |
| `defaultValue` | `boolean` | ❌ | デフォルト値（未指定時は `undefined`） |

### 戻り値

`true` (Yes) または `false` (No) を `Promise<boolean>` で返します。

### 例

```typescript
// 基本的な使い方
const shouldContinue = await confirm('続行しますか？')
if (!shouldContinue) {
  console.log('キャンセルしました')
  return
}

// デフォルト値: Yes
const shouldDeploy = await confirm('デプロイしますか？', { defaultValue: true })

// デフォルト値: No（危険な操作）
const shouldDelete = await confirm('本当に削除しますか？', { defaultValue: false })

// 実用例: Git コミット前の確認
const { stdout } = await $`git diff --cached --name-only`
const files = stdout.split('\n').filter(Boolean)

console.log('変更されたファイル:')
files.forEach(f => console.log(`  - ${f}`))

const shouldCommit = await confirm('これらのファイルをコミットしますか？')
if (shouldCommit) {
  const message = await text('コミットメッセージ:')
  await $`git commit -m ${message}`
  console.log('✓ コミット完了')
}
```

---

## multiSelect()

複数選択プロンプト。

### 構文

```typescript
async function multiSelect<T>(
  message: string,
  choices: T[] | SelectChoice<T>[]
): Promise<T[]>
```

### パラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|-----|------|------|
| `message` | `string` | ✅ | プロンプトメッセージ |
| `choices` | `T[]` or `SelectChoice<T>[]` | ✅ | 選択肢の配列 |

### 戻り値

選択された値の配列を `Promise<T[]>` で返します。

### 例

```typescript
// 文字列の配列
const colors = await multiSelect('色を選択（複数可）:', ['red', 'blue', 'green', 'yellow'])
console.log(colors) // ['red', 'green'] など

// SelectChoice オブジェクト
const features = await multiSelect('有効にする機能:', [
  { label: 'TypeScript', value: 'typescript' },
  { label: 'ESLint', value: 'eslint' },
  { label: 'Prettier', value: 'prettier' },
  { label: 'Vitest', value: 'vitest' },
])

console.log(features) // ['typescript', 'eslint'] など

// 実用例: 複数のファイルを選択してコミット
const { stdout } = await $`git status --short`
const files = stdout
  .split('\n')
  .filter(Boolean)
  .map(line => line.slice(3)) // "M file.ts" -> "file.ts"

const selectedFiles = await multiSelect(
  'コミットするファイルを選択:',
  files
)

if (selectedFiles.length === 0) {
  console.log('ファイルが選択されませんでした')
  return
}

for (const file of selectedFiles) {
  await $`git add ${file}`
}

const message = await text('コミットメッセージ:')
await $`git commit -m ${message}`
console.log(`✓ ${selectedFiles.length}個のファイルをコミットしました`)
```

---

## 組み合わせ例

複数のプロンプトを組み合わせた実用例：

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'create-pr',
  description: 'プルリクエストを作成',
  category: 'git',
  tags: ['git', 'pr', 'github'],
  async run({ prompt, $ }) {
    // 1. ブランチ選択
    const { stdout: branchList } = await $`git branch --format=%(refname:short)`
    const branches = branchList.split('\n').filter(Boolean)

    const targetBranch = await select('マージ先のブランチ:', branches)

    // 2. タイトル入力
    const title = await text('PRタイトル:', {
      validate: (v) => v.length > 0 || 'タイトルを入力してください',
    })

    // 3. 説明入力
    const description = await text('PR説明:', {
      placeholder: '変更内容を入力...',
    })

    // 4. レビュアー選択（複数）
    const reviewers = await multiSelect('レビュアーを選択:', [
      { label: 'Alice', value: 'alice' },
      { label: 'Bob', value: 'bob' },
      { label: 'Charlie', value: 'charlie' },
    ])

    // 5. ドラフトPRか確認
    const isDraft = await confirm('ドラフトPRとして作成しますか？', { defaultValue: false })

    // 6. 最終確認
    console.log('\nPR情報:')
    console.log(`  タイトル: ${title}`)
    console.log(`  マージ先: ${targetBranch}`)
    console.log(`  レビュアー: ${reviewers.join(', ')}`)
    console.log(`  ドラフト: ${isDraft ? 'Yes' : 'No'}`)

    const confirmed = await confirm('\nこの内容でPRを作成しますか？', { defaultValue: true })

    if (!confirmed) {
      console.log('キャンセルしました')
      return
    }

    // 7. PR作成（gh コマンド使用）
    const draftFlag = isDraft ? '--draft' : ''
    const reviewerFlags = reviewers.map(r => `--reviewer ${r}`).join(' ')

    await $`gh pr create --title ${title} --body ${description} --base ${targetBranch} ${draftFlag} ${reviewerFlags}`

    console.log('✓ PRを作成しました')
  },
})
```

---

## tui.prompt() - フォームモード

複数フィールドを一度に入力するフォームを作成できます。

### 単一フォーム

```typescript
const result = await tui.prompt({
  title: 'ユーザー登録',
  description: '必要な情報を入力してください',
  fields: {
    name: { type: 'text', message: '名前' },
    email: { type: 'text', message: 'メールアドレス' },
    age: { type: 'number', message: '年齢', min: 0, max: 150 },
  },
})
// result: { name: string, email: string, age: number }
```

### フィールドタイプ

フォーム内で使用可能なフィールドタイプ：

| タイプ | 説明 | 値の型 |
|--------|------|--------|
| `text` | テキスト入力 | `string` |
| `number` | 数値入力 | `number` |
| `password` | パスワード入力（非表示） | `string` |
| `select` | 単一選択 | `T` |
| `confirm` | Yes/No 確認 | `boolean` |
| `multiSelect` | 複数選択 | `T[]` |

### フィールドオプション

各フィールドタイプで使用可能なオプション：

```typescript
// text フィールド
name: {
  type: 'text',
  message: '名前',
  placeholder: 'John Doe',
  defaultValue: '',
  description: 'フルネームを入力してください',
  validate: (value) => value.length > 0 || '名前は必須です',
}

// number フィールド
age: {
  type: 'number',
  message: '年齢',
  min: 0,
  max: 150,
  defaultValue: 25,
  validate: (value) => value >= 18 || '18歳以上である必要があります',
}

// password フィールド
password: {
  type: 'password',
  message: 'パスワード',
  minLength: 8,
  validate: (value) => value.length >= 8 || '8文字以上で入力してください',
}

// select フィールド
country: {
  type: 'select',
  message: '国',
  choices: [
    { label: '日本', value: 'jp' },
    { label: 'アメリカ', value: 'us' },
    { label: 'イギリス', value: 'uk' },
  ],
}

// confirm フィールド
newsletter: {
  type: 'confirm',
  message: 'ニュースレターを購読しますか？',
  defaultValue: false,
}

// multiSelect フィールド
interests: {
  type: 'multiSelect',
  message: '興味のある分野',
  choices: ['Technology', 'Music', 'Sports', 'Art'],
  min: 1,
  max: 3,
}
```

### フィールドレベルバリデーション

各フィールドに `validate` 関数を設定できます。`ctx.values` で他のフィールドの値にアクセス可能：

```typescript
const result = await tui.prompt({
  fields: {
    email: {
      type: 'text',
      message: 'メールアドレス',
      validate: (value) => {
        if (!value.includes('@')) {
          return 'メールアドレスの形式が正しくありません'
        }
        return true
      },
    },
    confirmEmail: {
      type: 'text',
      message: 'メールアドレス確認',
      validate: (value, ctx) => {
        if (value !== ctx.values.email) {
          return 'メールアドレスが一致しません'
        }
        return true
      },
    },
  },
})
```

### フォームレベルバリデーション

フォーム全体のバリデーション（複数フィールドの関係を検証）：

```typescript
const result = await tui.prompt({
  fields: {
    password: { type: 'password', message: 'パスワード' },
    confirmPassword: { type: 'password', message: 'パスワード確認' },
  },
  validate: (values) => {
    if (values.password !== values.confirmPassword) {
      return 'パスワードが一致しません'
    }
    return true
  },
})
```

### フォームオプション

| プロパティ | 型 | 説明 |
|-----------|-----|------|
| `title` | `string` | フォームタイトル |
| `description` | `string` | フォームの説明 |
| `fields` | `FormFields` | フィールド定義 |
| `submitLabel` | `string` | 送信ボタンのラベル（デフォルト: "Submit"） |
| `cancelLabel` | `string` | キャンセルボタンのラベル（デフォルト: "Cancel"） |
| `validate` | `(values) => boolean \| string` | フォームレベルバリデーション |

---

## ステップフォーム（ウィザード）

配列形式でフォームを渡すと、ステップ形式のウィザードになります：

```typescript
const result = await tui.prompt([
  {
    title: 'ステップ 1: 基本情報',
    fields: {
      name: { type: 'text', message: '名前' },
      email: { type: 'text', message: 'メール' },
    },
  },
  {
    title: 'ステップ 2: 詳細設定',
    fields: {
      theme: {
        type: 'select',
        message: 'テーマ',
        choices: ['light', 'dark', 'system'],
      },
      notifications: { type: 'confirm', message: '通知を有効にする？' },
    },
  },
])
// result: { name: string, email: string, theme: string, notifications: boolean }
```

### 進捗インジケーター

```
Step 1/3 ◉○○ [タイトル]
```

### クロスステップバリデーション

ステップフォームの第2引数でオプションを渡せます：

```typescript
const result = await tui.prompt(
  [
    {
      title: 'パスワード設定',
      fields: {
        password: { type: 'password', message: 'パスワード' },
      },
    },
    {
      title: '確認',
      fields: {
        confirmPassword: { type: 'password', message: 'パスワード確認' },
      },
    },
  ],
  {
    // 最終送信時に全ステップの値を検証
    validate: (values) => {
      if (values.password !== values.confirmPassword) {
        return 'パスワードが一致しません'
      }
      return true
    },
  }
)
```

### 値の保持

戻るボタンで前のステップに戻った場合、入力した値は保持されます。

---

## 型定義

```typescript
interface PromptAPI {
  // Shorthand methods
  text(message: string, options?: TextOptions): Promise<string>
  number(message: string, options?: NumberOptions): Promise<number>
  password(message: string, options?: PasswordOptions): Promise<string>
  select<T>(message: string, choices: T[] | SelectChoice<T>[]): Promise<T>
  confirm(message: string, options?: ConfirmOptions): Promise<boolean>
  multiSelect<T>(message: string, choices: T[] | SelectChoice<T>[]): Promise<T[]>

  // Form mode (callable)
  (form: FormPage): Promise<FormResult>
  (steps: FormPage[], options?: StepFormOptions): Promise<MergedFormResult>
}

interface TextOptions {
  placeholder?: string
  defaultValue?: string
  validate?: (value: string) => boolean | string
  prefix?: string
  suffix?: string
  maxLength?: number
  minLength?: number
  pattern?: RegExp
  format?: 'lowercase' | 'uppercase' | 'trim' | 'kebab-case' | ((value: string) => string)
}

interface NumberOptions {
  placeholder?: string
  defaultValue?: number
  min?: number
  max?: number
  validate?: (value: number) => boolean | string
}

interface PasswordOptions {
  placeholder?: string
  minLength?: number
  validate?: (value: string) => boolean | string
}

interface ConfirmOptions {
  defaultValue?: boolean
}

interface SelectChoice<T = string> {
  label: string
  value: T
  description?: string
}

// Form types
interface FormPage<T extends FormFields = FormFields> {
  title?: string
  description?: string
  fields: T
  submitLabel?: string
  cancelLabel?: string
  validate?: (values: FormResult<T>) => boolean | string
}

interface FormField {
  type: 'text' | 'number' | 'password' | 'select' | 'confirm' | 'multiSelect'
  message: string
  description?: string
  validate?: (value: any, ctx: { values: Record<string, unknown> }) => boolean | string
  // Type-specific options (placeholder, choices, min, max, etc.)
}

interface StepFormOptions {
  validate?: (values: MergedFormResult) => boolean | string
}
```

## 参照

- [defineAction API](./define-action)
- [$ (shell) API](./shell.md)
- [アクション作成チュートリアル](/guides/actions/creating)
