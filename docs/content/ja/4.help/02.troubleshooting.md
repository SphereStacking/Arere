---
title: トラブルシューティング
description: よくある問題と解決方法
---

# トラブルシューティング

よくある問題と解決方法をまとめています。

## インストール関連

### `arere: command not found`

npm のグローバルディレクトリが PATH に含まれていません。

**解決方法 1**: PATH に追加

```bash
# PATH を確認
echo $PATH
npm bin -g

# PATH に追加
echo 'export PATH=$(npm bin -g):$PATH' >> ~/.bashrc
source ~/.bashrc
```

**解決方法 2**: npm のグローバルディレクトリを変更

```bash
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# 再インストール
npm install -g arere
```

### 権限エラー（EACCES）

macOS/Linux で `npm install -g` が権限エラーになる場合。

**解決方法**: npm のグローバルディレクトリを変更

```bash
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

npm install -g arere
```

:::alert{type="warning"}
`sudo npm install -g` は推奨しません。セキュリティリスクがあります。
:::

---

## アクション関連

### アクションが見つからない

アクションが表示されない場合。

**確認ポイント**:

1. アクションファイルの配置を確認
   ```bash
   ls -la ~/.arere
   ls -la ./.arere
   ```

2. ファイルの拡張子が `.ts` であることを確認

3. `export default` でアクションをエクスポートしているか確認
   ```typescript
   export default defineAction({...})  // ✅
   const action = defineAction({...})  // ❌ export がない
   ```

4. キャッシュをクリア
   ```bash
   rm -rf ~/.cache/arere
   ```

### TypeScript のコンパイルエラー

アクション内の TypeScript エラー。

**解決方法**:

arere はコンパイルエラーがあっても実行を試みます。型チェックを行う場合：

```bash
npx tsc --noEmit your-action.ts
```

エラーを修正するか、`@ts-ignore` で一時的に無視できます：

```typescript
// @ts-ignore
const result = someFunctionWithTypeError()
```

### アクションがハングする（終わらない）

アクションが終了しない場合。

**考えられる原因**:

1. **無限ループ**: while や for ループの終了条件を確認
2. **Promise が解決されない**: await の使用を確認
3. **外部プロセスが終了しない**: シェルコマンドの実行を確認

**デバッグ方法**:

```typescript
export default defineAction({
  async run({ tui }) {
    tui.output.log('Step 1')
    await someFunction()
    tui.output.log('Step 2')  // ここに到達するか確認
    // ...
  }
})
```

---

## シェルコマンド関連

### コマンドが実行されない

`$` でシェルコマンドが動かない場合。

**確認ポイント**:

1. `$` を正しくインポートしているか
   ```typescript
   async run({ $ }) {  // ✅ $ をデストラクチャリング
     await $`git status`
   }
   ```

2. `await` を付けているか
   ```typescript
   await $`git status`    // ✅
   $`git status`          // ❌ await がない
   ```

### コマンドのエラーが無視される

コマンドが失敗してもエラーにならない場合。

**原因**: `$` はエラーを throw しません。結果オブジェクトの `exitCode` を確認する必要があります。

**解決方法**: 終了コードを確認

```typescript
const result = await $`git status`
if (result.exitCode !== 0) {
  tui.output.error('コマンドが失敗しました')
}
```

---

## 設定ファイル関連

### 設定が反映されない

設定ファイルが正しい場所にあるか確認：

```bash
# ユーザー設定
cat ~/.arere/settings.json

# ワークスペース設定
cat .arere/settings.json
```

設定ファイルが有効な JSON か確認：

```bash
cat .arere/settings.json | jq
```

### キーバインドが反応しない

1. **JSON の文法を確認**
   ```bash
   cat .arere/keybindings.json | jq
   ```

2. **キー表記が正しいか確認**
   - `Ctrl+C` → `ctrl+c`（小文字）
   - `Enter` → `enter`
   - `Escape` → `esc` または `escape`

3. **スコープ内の全アクションを定義しているか確認**
   完全置換のため、スコープを定義する場合は全アクションが必要です。

4. **ターミナルの制限**
   一部のキー組み合わせはターミナルで使用できない場合があります。

### JSON のパースエラー

よくあるエラー：
- 末尾のカンマ（trailing comma）
- ダブルクォートの不足
- 括弧の不一致

```bash
# jq でバリデーション
cat .arere/settings.json | jq
```

---

## プラグイン関連

### プラグインが認識されない

インストールしたプラグインが表示されない場合。

**確認ポイント**:

1. プラグインがインストールされているか確認
   ```bash
   npm list -g | grep arere-plugin
   ```

2. プラグイン名が `arere-plugin-` で始まっているか確認

3. 設定ファイルでプラグインが有効になっているか確認
   ```json
   // ~/.arere/settings.json
   {
     "plugins": {
       "arere-plugin-git": true
     }
   }
   ```

4. キャッシュをクリア
   ```bash
   rm -rf ~/.cache/arere
   ```

### プラグインの翻訳が表示されない

多言語対応したプラグインで翻訳が機能しない場合。

**確認ポイント**:

1. `locales` ディレクトリが正しい場所にあるか
   ```
   arere-plugin-example/
   ├── locales/
   │   ├── en/translation.json
   │   └── ja/translation.json
   ```

2. プラグイン定義で `locales` を指定しているか
   ```typescript
   export default definePlugin({
     meta: { name: 'arere-plugin-example', version: '1.0.0' },
     actions: ['actions/example.ts'],
     locales: 'locales'  // この行を追加
   })
   ```

3. `package.json` の `files` に `locales` が含まれているか
   ```json
   "files": ["dist", "actions", "locales"]
   ```

4. アクション内で `plugin:` プレフィックスを使用しているか
   ```typescript
   t('plugin:greeting')  // ✅
   t('greeting')         // ❌
   ```

---

## CI/CD 関連

### GitHub Actions で動かない

GitHub Actions でエラーになる場合。

**確認ポイント**:

1. Node.js のバージョン
   ```yaml
   - uses: actions/setup-node@v4
     with:
       node-version: '18'  # 18 以上
   ```

2. arere がインストールされているか
   ```yaml
   - run: npm install arere
   ```

3. アクション名が正しいか
   ```yaml
   - run: npx arere run deploy  # アクション名を確認
   ```

4. 環境変数が設定されているか
   ```yaml
   - run: npx arere run deploy
     env:
       API_KEY: ${{ secrets.API_KEY }}
   ```

### アクションが見つからない（CI環境）

**エラー:** `Action "my-action" not found`

アクションファイルが`.arere/`ディレクトリに存在し、`name`と`run`を持つデフォルトオブジェクトをエクスポートしていることを確認。

### 環境変数が利用できない

**エラー:** `Cannot read property 'API_KEY' of undefined`

ワークフローで`env:`セクションを設定していることを確認：

```yaml
- uses: ./actions/arere-action
  with:
    action: deploy
  env:
    API_KEY: ${{ secrets.API_KEY }}
```

### 終了コードの問題

**問題:** コマンドが失敗してもGitHub Actionsが成功を表示

`await $\`...\``を使用し、終了コードをチェック：

```typescript
const result = await $`npm test`
if (result.exitCode !== 0) {
  throw new Error('コマンドが失敗しました')
}
```

---

## パフォーマンス関連

### 起動が遅い

arere の起動に時間がかかる場合。

**解決方法**:

1. キャッシュをクリア
   ```bash
   rm -rf ~/.cache/arere
   ```

2. 不要なプラグインを削除

3. アクションファイルの数を減らす

### メモリ使用量が多い

メモリを多く消費している場合。

**考えられる原因**:

- 大きなファイルをメモリに読み込んでいる
- ループ内でオブジェクトを大量に作成している

**解決方法**:

- ストリーミング処理を使用
- 不要なデータを早めに解放

---

## それでも解決しない場合

1. **GitHub Issues を確認**
   既知の問題かもしれません：
   https://github.com/your-org/arere/issues

2. **デバッグモードで実行**
   ```bash
   DEBUG=arere* arere
   ```

3. **新しい Issue を作成**
   以下の情報を含めてください：
   - arere のバージョン (`arere --version`)
   - Node.js のバージョン (`node --version`)
   - OS とバージョン
   - エラーメッセージの全文
   - 再現手順
