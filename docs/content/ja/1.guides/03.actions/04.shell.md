---
title: シェルコマンド
description: シェルコマンドの実行と外部ライブラリの使用方法
---

# シェルコマンド

## 基本的な使い方

`$` を使ってシェルコマンドを実行できます：

```typescript
// ~/.arere/git-status.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'git-status',
  description: 'Git のステータスを表示',
  category: 'git',
  async run({ $, tui }) {
    // コマンド実行
    const { stdout } = await $`git status --short`

    tui.output.log(stdout)
  }
})
```

## エラーハンドリング

コマンドが失敗した場合の処理：

```typescript
// ~/.arere/check-git.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'check-git',
  description: 'Git リポジトリかチェック',
  async run({ $, tui }) {
    const result = await $`git status`
    if (result.exitCode === 0) {
      tui.output.success('✓ Gitリポジトリです')
    } else {
      tui.output.error('✗ Gitリポジトリではありません')
    }
  }
})
```

::alert{type="info"}
シェルコマンドはエラーをthrowしません。`result.exitCode` で成功/失敗を判定してください。
::

## 実用例: Git コミット

```typescript
// ~/.arere/git-commit.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'git-commit',
  description: 'Git コミットを作成',
  category: 'git',
  async run({ $, tui }) {
    // ステージされたファイルを確認
    const { stdout } = await $`git diff --cached --name-only`
    const files = stdout.split('\n').filter(Boolean)

    if (files.length === 0) {
      tui.output.warn('ステージされたファイルがありません')
      return
    }

    tui.output.info('変更されたファイル:')
    files.forEach(f => tui.output.log(`  - ${f}`))

    // コミットメッセージを入力
    const message = await tui.prompt.text('コミットメッセージ:', {
      validate: v => v.length > 0 || 'メッセージを入力してください',
    })

    // 確認
    const confirmed = await tui.prompt.confirm(`"${message}" でコミットしますか？`, { defaultValue: true })

    if (!confirmed) {
      tui.output.warn('キャンセルしました')
      return
    }

    // コミット実行
    await $`git commit -m ${message}`
    tui.output.success('✓ コミット完了')
  }
})
```

---

## 外部ライブラリを使用する

アクションから外部ライブラリを使用できます。

### グローバルインストール

```bash
npm install -g date-fns chalk
```

### アクションで使用

```typescript
// ~/.arere/format-date.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'format-date',
  description: '現在時刻をフォーマット',
  async run({ tui }) {
    // 外部ライブラリを動的インポート
    const { format } = await import('date-fns')
    const chalk = (await import('chalk')).default

    const now = new Date()
    const formatted = format(now, 'yyyy-MM-dd HH:mm:ss')

    tui.output.log(chalk.blue(`現在時刻: ${formatted}`))
  }
})
```

### HTTP リクエスト

```typescript
// ~/.arere/fetch-weather.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'fetch-weather',
  description: '天気情報を取得',
  async run({ tui }) {
    const city = await tui.prompt.text('都市名を入力:', {
      defaultValue: 'Tokyo',
    })

    // fetch API を使用
    const response = await fetch(
      `https://wttr.in/${city}?format=3`
    )
    const weather = await response.text()

    tui.output.log(weather)
  }
})
```

---

## 次のステップ

- [高度なテクニック](./05.advanced.md) - 進捗表示、CI/CD、i18n
- [Shell API](/ja/2.api/4.shell) - 詳細なリファレンス
