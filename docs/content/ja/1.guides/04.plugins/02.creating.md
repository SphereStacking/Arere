---
title: プラグインの作成
description: arereプラグインの作成方法を学びます
---

# プラグインの作成

## 1. プロジェクトの初期化

```bash
# プラグインディレクトリを作成
mkdir arere-plugin-example
cd arere-plugin-example

# package.json を作成
npm init -y

# 必要なパッケージをインストール
npm install --save-dev arere tsup typescript
```

## 2. package.json の設定

```json
{
  "name": "arere-plugin-example",
  "version": "1.0.0",
  "description": "Example plugin for arere",
  "keywords": ["arere-plugin"],
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "files": [
    "dist",
    "actions"
  ],
  "scripts": {
    "build": "tsup",
    "dev": "tsup --watch",
    "test": "vitest run",
    "prepublishOnly": "npm run build"
  },
  "peerDependencies": {
    "arere": ">=0.1.0"
  },
  "devDependencies": {
    "arere": "^0.1.0",
    "tsup": "^8.0.0",
    "typescript": "^5.0.0",
    "vitest": "^1.0.0"
  }
}
```

**重要なポイント**:
- `keywords` に `"arere-plugin"` を含める
- `files` に `"dist"` と `"actions"` を含める
- `peerDependencies` に `"arere"` を指定

## 3. TypeScript設定 (tsconfig.json)

```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": ["ES2022"],
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "declaration": true,
    "outDir": "./dist"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

## 4. ビルド設定 (tsup.config.ts)

```typescript
import { defineConfig } from 'tsup'

export default defineConfig({
  entry: ['src/index.ts'],
  format: ['esm'],
  dts: true,
  clean: true,
  outDir: 'dist',
})
```

## 5. プラグイン定義 (src/index.ts)

```typescript
import { definePlugin } from 'arere'

export default definePlugin({
  meta: {
    name: 'arere-plugin-example',
    version: '1.0.0',
    description: 'Example plugin for arere',
    author: 'Your Name',
  },
  actions: [
    './actions/hello.ts',
    './actions/goodbye.ts',
  ],
})
```

::alert{type="tip"}
`definePlugin()` ヘルパー関数を使用することで、型チェックとバリデーションが行われます。
::

---

## アクションの追加

### 基本的なアクション

```typescript
// actions/hello.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'example-hello',
  description: 'Hello を表示',
  category: 'example',
  tags: ['example', 'demo'],
  async run({ tui }) {
    tui.output.log('Hello from plugin!')
  },
})
```

### プロンプトを使用

```typescript
// actions/greet.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'example-greet',
  description: '挨拶する',
  category: 'example',
  tags: ['example', 'interactive'],
  async run({ tui }) {
    const name = await tui.prompt.text('お名前は？', {
      placeholder: '山田太郎',
    })

    tui.output.log(`こんにちは、${name}さん！`)
  },
})
```

### シェルコマンド実行

```typescript
// actions/git-info.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'example-git-info',
  description: 'Git リポジトリ情報を表示',
  category: 'example',
  tags: ['example', 'git', 'info'],
  async run({ $, tui }) {
    const branchResult = await $`git branch --show-current`
    if (branchResult.exitCode !== 0) {
      tui.output.error('Gitリポジトリではありません')
      return
    }

    const remoteResult = await $`git remote get-url origin`

    tui.output.log(`ブランチ: ${branchResult.stdout}`)
    tui.output.log(`リモート: ${remoteResult.stdout}`)
  },
})
```

::alert{type="info"}
シェルコマンドはエラーをthrowしません。`result.exitCode` で成功/失敗を判定してください。
::

---

## 外部ライブラリの使用

プラグインは独自の依存関係を持つことができます。

### 1. ライブラリのインストール

```bash
npm install date-fns chalk
```

### 2. package.json に追加

```json
{
  "dependencies": {
    "date-fns": "^2.30.0",
    "chalk": "^5.3.0"
  }
}
```

### 3. アクションで使用

```typescript
// actions/format-date.ts
import { defineAction } from 'arere'
import { format } from 'date-fns'
import chalk from 'chalk'

export default defineAction({
  name: 'example-format-date',
  description: '現在時刻をフォーマット',
  category: 'example',
  tags: ['example', 'date', 'time'],
  async run({ tui }) {
    const now = new Date()
    const formatted = format(now, 'yyyy-MM-dd HH:mm:ss')

    tui.output.log(chalk.blue(`現在時刻: ${formatted}`))
  },
})
```

---

## 次のステップ

- [設定スキーマ](./03.config.md) - プラグイン設定の定義
- [公開・配布](./04.publishing.md) - npmへの公開方法
- [Plugin API](/ja/2.api/6.plugin) - 詳細なAPI仕様
