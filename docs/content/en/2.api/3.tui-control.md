---
title: TUI Control API
description: API reference for fine-grained control over terminal output timing, user interaction pauses, and visual feedback
---

# Control API Reference

The Control API (`tui.control`) provides APIs for fine-grained control over terminal output timing, user interaction pauses, and visual feedback.

## Overview

```typescript
const context: ActionContext = {
  tui: {
    control: {
      // Timing control
      delay(ms: number): Promise<void>
      waitForEnter(message?: string): Promise<void>
      waitForKey(options?: WaitForKeyOptions): Promise<string>

      // Visual feedback
      spinner(options?: SpinnerOptions): SpinnerControl
      progress(options?: ProgressOptions): ProgressControl

      // Terminal utilities
      isInteractive(): boolean
      getTerminalSize(): TerminalSize
    }
  }
}
```

---

## Timing Control

### `delay(ms)`

Pauses execution for the specified number of milliseconds.

**Parameters:**
- `ms` (number): Delay time in milliseconds

**Returns:** `Promise<void>`

**Error:** Throws error if `ms` is negative

**Example:**
```typescript
await tui.control.delay(1000)  // Wait 1 second
```

**Notes:**
- Automatically skips delay in test environments (`NODE_ENV=test` or `VITEST=true`)
- Displays warning for delays over 30 seconds
- Respects Ctrl+C cancellation

---

### `waitForEnter(message?)`

Waits until the user presses the Enter key.

**Parameters:**
- `message` (string, optional): Message to display while waiting

**Returns:** `Promise<void>`

**Example:**
```typescript
await tui.control.waitForEnter('Press Enter to continue...')
```

**Note:** Requires Ink rendering context. Not available in headless mode.

---

### `waitForKey(options?)`

Waits until the user presses a specific key or any key.

**Parameters:**
- `options` (WaitForKeyOptions, optional):
  - `keys` (string[], optional): Specific keys to accept. Accepts any key if omitted.
  - `message` (string, optional): Message to display while waiting
  - `timeout` (number, optional): Timeout in milliseconds
  - `caseInsensitive` (boolean, optional): Case-insensitive matching (default: false)

**Returns:** `Promise<string>` - The key pressed

**Example:**
```typescript
// Wait for any key
const key = await tui.control.waitForKey()

// Wait for specific keys
const choice = await tui.control.waitForKey({
  keys: ['y', 'n'],
  message: 'Continue? [y/n]',
  caseInsensitive: true
})

if (choice === 'y') {
  // User pressed 'y' or 'Y'
}
```

---

## Visual Feedback

### `spinner(options?)`

Creates and controls a spinner for ongoing operations.

**Parameters:**
- `options` (SpinnerOptions, optional):
  - `type` ('dots' | 'line' | 'arc', optional): Spinner animation type (default: 'dots')
  - `message` (string, optional): Initial message (default: 'Loading...')

**Returns:** `SpinnerControl` object with methods:
- `start()`: Start the spinner
- `stop()`: Stop the spinner
- `succeed(message?)`: Mark as success and stop (auto-clears after 1 second)
- `fail(message?)`: Mark as failure and stop (auto-clears after 1 second)
- `update(message)`: Update spinner message

**Example:**
```typescript
const spinner = tui.control.spinner({
  type: 'dots',
  message: 'Loading data...'
})

spinner.start()

try {
  await fetchData()
  spinner.succeed('Data loaded!')
} catch (error) {
  spinner.fail('Failed to load data')
}
```

---

### `progress(options?)`

Creates and controls a progress bar for operations with known total.

**Parameters:**
- `options` (ProgressOptions, optional):
  - `total` (number, optional): Total value (default: 100)
  - `value` (number, optional): Initial value (default: 0)
  - `message` (string, optional): Initial message (default: 'Processing...')

**Returns:** `ProgressControl` object with methods:
- `start()`: Start the progress bar
- `update(value)`: Update progress value (clamped to total)
- `increment(delta?)`: Increase by delta (default: 1)
- `stop()`: Stop the progress bar
- `succeed(message?)`: Mark as success and stop (auto-clears after 1 second)
- `fail(message?)`: Mark as failure and stop (auto-clears after 1 second)

**Example:**
```typescript
const progress = tui.control.progress({
  total: 100,
  message: 'Downloading files...'
})

progress.start()

for (let i = 0; i <= 100; i += 10) {
  await downloadChunk(i)
  progress.update(i)
}

progress.succeed('Download complete!')
```

---

## Terminal Utilities

### `isInteractive()`

Checks if the current terminal environment is interactive.

**Returns:** `boolean` - true if interactive (TTY)

**Example:**
```typescript
if (tui.control.isInteractive()) {
  // Use rich UI features
  const spinner = tui.control.spinner()
  spinner.start()
} else {
  // Fallback to simple output
  tui.output.log('Processing...')
}
```

**Detection Logic:**
- Returns `false` if not TTY (`!process.stdout.isTTY`)
- Returns `false` in CI environments (`process.env.CI === 'true'`)
- Returns `false` if `NO_COLOR` is set
- Returns `false` if `TERM=dumb`
- Otherwise returns `true`

---

### `getTerminalSize()`

Gets the current terminal dimensions.

**Returns:** `TerminalSize` object:
- `width` (number): Terminal width in columns
- `height` (number): Terminal height in rows

**Example:**
```typescript
const size = tui.control.getTerminalSize()
tui.output.log(`Terminal: ${size.width}x${size.height}`)

if (size.width < 80) {
  tui.output.warn('Terminal is narrow, some output may wrap')
}
```

**Default Values:** If terminal size cannot be determined, returns `{ width: 80, height: 24 }`.

---

## Best Practices

### 1. Check Interactive Mode

Always check if the terminal is interactive before using spinner/progress:

```typescript
if (tui.control.isInteractive()) {
  const spinner = tui.control.spinner()
  spinner.start()
  await operation()
  spinner.succeed()
} else {
  tui.output.log('Executing operation...')
  await operation()
  tui.output.success('Operation complete')
}
```

### 2. Use Appropriate Visual Feedback

- **Spinner**: For operations with unknown duration
- **Progress**: For operations with known total steps

### 3. Handle Errors Properly

```typescript
const spinner = tui.control.spinner({ message: 'Processing...' })
spinner.start()

try {
  await riskyOperation()
  spinner.succeed('Success!')
} catch (error) {
  spinner.fail('Operation failed')
  throw error
}
```

---

## See Also

- [Prompt API](./prompt.md) - For collecting user input
- [TUI API](./tui.md) - For displaying messages (Output API)
