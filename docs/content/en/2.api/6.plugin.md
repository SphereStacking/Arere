---
title: Plugin API
description: API reference for distributing and sharing actions as npm packages using the plugin system
---

# Plugin API

Use the plugin system to distribute and share actions as npm packages.

## What is a Plugin?

A plugin is an npm package with the following characteristics:

- Package name starts with `arere-plugin-`
- `package.json` `keywords` contains `arere-plugin`
- Contains action files

## Creating a Plugin

### 1. Project Structure

```
arere-plugin-example/
├── package.json
├── src/
│   └── index.ts          # Plugin definition
├── actions/
│   ├── action-1.ts       # Action 1
│   └── action-2.ts       # Action 2
├── tsup.config.ts        # Build configuration
└── README.md
```

### 2. package.json

```json
{
  "name": "arere-plugin-example",
  "version": "1.0.0",
  "description": "Example plugin for arere",
  "keywords": ["arere-plugin"],
  "main": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "files": [
    "dist",
    "actions"
  ],
  "scripts": {
    "build": "tsup",
    "prepublishOnly": "npm run build"
  },
  "peerDependencies": {
    "arere": ">=0.1.0"
  },
  "devDependencies": {
    "arere": "^0.1.0",
    "tsup": "^8.0.0",
    "typescript": "^5.0.0"
  }
}
```

### 3. Plugin Definition (src/index.ts)

```typescript
import { definePlugin } from 'arere'

export default definePlugin({
  meta: {
    name: 'arere-plugin-example',
    version: '1.0.0',
    description: 'Example plugin',
    author: 'Your Name',
  },
  actions: [
    './actions/action-1.ts',
    './actions/action-2.ts',
  ],
})
```

### 4. Create Action (actions/action-1.ts)

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'example-action',
  description: 'Example action from plugin',
  category: 'example',
  async run({ tui }) {
    tui.output.log('Hello from plugin!')
  },
})
```

**With i18n support**:

```typescript
import { defineAction } from 'arere'

export default defineAction({
  name: 'example-action',
  description: ({ t }) => t('actions.example.description', { ns: 'example-plugin' }),
  category: 'example',
  async run({ tui, t }) {
    const greeting = t('greeting', { ns: 'example-plugin' })
    tui.output.log(greeting)
  },
})
```

### 5. Build Configuration (tsup.config.ts)

```typescript
import { defineConfig } from 'tsup'

export default defineConfig({
  entry: ['src/index.ts'],
  format: ['esm'],
  dts: true,
  clean: true,
  outDir: 'dist',
})
```

## Installing Plugins

### Global Installation

```bash
npm install -g arere-plugin-example
```

### Project Local

```bash
npm install --save-dev arere-plugin-example
```

## Enabling Plugins

Plugins are automatically detected from `node_modules`. You can enable/disable them in the configuration file:

### Configuration File (.arere/settings.json)

```json
{
  "plugins": {
    "arere-plugin-git": true,
    "arere-plugin-docker": true,
    "arere-plugin-example": {
      "enabled": true,
      "config": {
        "apiKey": "your-api-key"
      }
    }
  }
}
```

You can also enable/disable plugins from the Settings screen.

## Using External Libraries in Plugins

Plugins can have their own dependencies.

### package.json

```json
{
  "name": "arere-plugin-with-deps",
  "dependencies": {
    "date-fns": "^2.30.0",
    "chalk": "^5.3.0"
  }
}
```

### Use in Actions

```typescript
// actions/date-formatter.ts
import { defineAction } from 'arere'
import { format } from 'date-fns'
import chalk from 'chalk'

export default defineAction({
  name: 'format-date',
  description: 'Format current time',
  async run({ tui }) {
    const now = new Date()
    const formatted = format(now, 'yyyy-MM-dd HH:mm:ss')
    tui.output.log(chalk.blue(`Current time: ${formatted}`))
  },
})
```

## Practical Examples

### Git Operations Plugin

```typescript
// arere-plugin-git/src/index.ts
import { definePlugin } from 'arere'

export default definePlugin({
  meta: {
    name: 'arere-plugin-git',
    version: '1.0.0',
    description: 'Git operations plugin',
  },
  actions: [
    './actions/git-status.ts',
    './actions/git-commit.ts',
    './actions/git-switch.ts',
    './actions/git-pull.ts',
    './actions/git-push.ts',
  ],
})
```

```typescript
// arere-plugin-git/actions/git-commit.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'git-commit',
  description: 'Create a Git commit',
  category: 'git',
  async run({ tui, $ }) {
    // Show staged files
    const { stdout } = await $`git diff --cached --name-only`
    const files = stdout.split('\n').filter(Boolean)

    if (files.length === 0) {
      tui.output.warn('No staged files')
      return
    }

    tui.output.log('Changed files:')
    files.forEach(f => tui.output.log(`  - ${f}`))

    // Enter commit message
    const message = await tui.prompt.text('Commit message:', {
      validate: v => v.length > 0 || 'Please enter a message',
    })

    // Execute commit
    await $`git commit -m ${message}`
    tui.output.success('Commit completed')
  },
})
```

### Docker Operations Plugin

```typescript
// arere-plugin-docker/src/index.ts
import { definePlugin } from 'arere'

export default definePlugin({
  meta: {
    name: 'arere-plugin-docker',
    version: '1.0.0',
    description: 'Docker operations plugin',
  },
  actions: [
    './actions/docker-ps.ts',
    './actions/docker-compose-up.ts',
    './actions/docker-compose-down.ts',
    './actions/docker-logs.ts',
  ],
})
```

```typescript
// arere-plugin-docker/actions/docker-compose-up.ts
import { defineAction } from 'arere'

export default defineAction({
  name: 'docker-compose-up',
  description: 'Start Docker Compose',
  category: 'docker',
  async run({ tui, $ }) {
    const detached = await tui.prompt.confirm(
      'Run in background?',
      { defaultValue: true }
    )

    const flags = detached ? '-d' : ''
    await $`docker-compose up ${flags}`

    if (detached) {
      tui.output.success('Docker Compose started')
    }
  },
})
```

## Testing Plugins

### Test Actions

```typescript
// tests/plugin.test.ts
import { describe, it, expect } from 'vitest'
import plugin from '../src/index'

describe('Plugin', () => {
  it('should have valid metadata', () => {
    expect(plugin.meta.name).toBe('arere-plugin-example')
    expect(plugin.meta.version).toBeDefined()
  })

  it('should have actions', () => {
    expect(plugin.actions.length).toBeGreaterThan(0)
  })

  it('should have valid action paths', () => {
    for (const action of plugin.actions) {
      expect(action).toMatch(/^\.\/actions\/.*\.ts$/)
    }
  })
})
```

## Publishing Plugins

### Publish to npm

```bash
# Build
npm run build

# Version bump
npm version patch  # or minor, major

# Publish
npm publish --access public
```

### Create README

```markdown
# arere-plugin-example

Example plugin for [arere](https://github.com/your-org/arere).

## Installation

\`\`\`bash
npm install -g arere-plugin-example
\`\`\`

## Usage

After installation, arere will automatically detect the plugin.

You can enable/disable the plugin from the Settings screen.

## Actions

- `example-action` - Example action

## License

MIT
```

## Best Practices

### 1. Naming Conventions

- Plugin name: `arere-plugin-{name}`
- Action name: `{plugin-name}-{action}` (e.g., `git-commit`, `docker-up`)

### 2. Category Classification

Set appropriate categories for actions:

```typescript
export default defineAction({
  name: 'git-commit',
  category: 'git',  // Categorize by category
  // ...
})
```

### 3. Using Icons

Use icons to improve visibility:

```typescript
export default defineAction({
  // ...
})
```

### 4. Error Handling

Implement proper error handling:

```typescript
export default defineAction({
  async run({ tui, $ }) {
    const result = await $`git status`
    if (result.exitCode !== 0) {
      tui.output.error('Git is not available')
      return
    }
  },
})
```

### 5. Validation

Properly validate user input:

```typescript
const message = await tui.prompt.text('Message:', {
  validate: (value) => {
    if (value.length === 0) return 'Please enter a message'
    if (value.length > 100) return 'Message must be 100 characters or less'
    return true
  },
})
```

## Type Definitions

```typescript
interface ArerePlugin {
  /** Plugin metadata */
  meta: PluginMeta
  /** Action file paths (relative to plugin root) */
  actions: string[]
  /** Translation file directory (relative to plugin root) */
  locales?: string
}

interface PluginMeta {
  /** Plugin name (arere-plugin-* format) */
  name: string
  /** Version (semantic versioning) */
  version: string
  /** Plugin description */
  description?: string
  /** Author */
  author?: string
  /** i18n namespace (defaults to plugin name) */
  i18nNamespace?: string
}

interface LoadedPlugin {
  /** Plugin metadata */
  meta: PluginMeta
  /** Absolute path to plugin directory */
  path: string
  /** Array of absolute paths to action files */
  actionPaths: string[]
  /** Absolute path to translation directory */
  localesPath?: string
  /** i18n namespace */
  i18nNamespace: string
}
```

### Field Details

#### `ArerePlugin.locales`

Path to the directory containing the plugin's translation files (relative to plugin root).

```typescript
import { definePlugin } from 'arere'

export default definePlugin({
  meta: { /* ... */ },
  actions: ['actions/example.ts'],
  locales: 'locales',  // Points to plugin-root/locales/
})
```

Translation file structure:
```
locales/
├── en/
│   └── translation.json
└── ja/
    └── translation.json
```

#### `PluginMeta.i18nNamespace`

The namespace used for plugin translations. If omitted, `meta.name` is used.

```typescript
// Use custom namespace
import { definePlugin } from 'arere'

export default definePlugin({
  meta: {
    name: 'arere-plugin-example',
    i18nNamespace: 'example',  // Use 'example' namespace for translations
  },
  locales: 'locales',
})
```

**Usage in actions**:

When accessing plugin translations, use the **`plugin:` prefix**:

```typescript
// In plugin action
export default defineAction({
  name: 'example-action',
  description: ({ t }) => t('plugin:actions.example.description'),
  async run({ t }) {
    // ✓ Correct
    const text = t('plugin:greeting')

    // ✗ Wrong (won't work)
    const wrong = t('greeting', { ns: 'example' })
  }
})
```

**Reason**: The `t()` function in actions uses the action's own namespace as the default. To access plugin translations, you need to explicitly specify the `plugin:` prefix.

## Troubleshooting

### Plugin Not Recognized

```bash
# Check if plugin is installed
npm list -g | grep arere-plugin

# Check configuration file
cat ~/.arere-config.json

# Clear cache
rm -rf ~/.cache/arere
```

### Actions Not Showing

- Check if action paths are included in the plugin's `actions` array
- Check if action files exist
- Check if built with `npm run build`

### Dependency Errors

Check if plugin dependencies are installed:

```bash
cd node_modules/arere-plugin-example
npm install
```

## References

- [Plugin Development Guide](/en/guides/plugins/creating)
- [defineAction API](./defineAction.md)
- [Action Creation Tutorial](/en/guides/actions/creating)
