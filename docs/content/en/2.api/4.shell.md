---
title: Shell Executor
description: API reference for executing shell commands
---

# $ (shell) API

API for executing shell commands.

## Import

```typescript
// In actions, use via context.$
```

In actions, use via `context.$`:

```typescript
export default defineAction({
  async run({ $ }) {
    await $`git status`
  }
})
```

## Syntax

```typescript
$`command ${arg1} ${arg2}`
```

Execute commands using template literal format. Variables are automatically escaped.

## Return Value

Returns `Promise<ShellResult>`.

### `ShellResult`

| Property | Type | Description |
|----------|------|-------------|
| `stdout` | `string` | Standard output |
| `stderr` | `string` | Standard error output |
| `exitCode` | `number` | Exit code |
| `command` | `string` | Executed command |

## Basic Usage

### Command Execution

```typescript
// Basic command
await $`echo Hello, World!`

// Get standard output
const { stdout } = await $`pwd`
tui.output.log('Current directory:', stdout)

// Multiple commands
await $`mkdir -p tmp/test`
await $`touch tmp/test/file.txt`
await $`ls -la tmp/test`
```

### Variable Expansion

```typescript
const fileName = 'test.txt'
const content = 'Hello, World!'

// Variables are automatically escaped
await $`echo ${content} > ${fileName}`

// Expand arrays
const files = ['file1.txt', 'file2.txt', 'file3.txt']
await $`rm ${files}` // rm file1.txt file2.txt file3.txt

// Numbers also work
const port = 3000
await $`lsof -i :${port}`
```

### Error Handling

`$` does not throw errors. Check `exitCode` to determine the result:

```typescript
// Check exitCode
const result = await $`git status`
if (result.exitCode !== 0) {
  tui.output.error('Not a Git repository')
  return
}

// Process on success
tui.output.log(result.stdout)
```

## Practical Examples

### Git Operations

```typescript
// Check status
const { stdout } = await $`git status --short`
tui.output.log(stdout)

// Branch list
const { stdout: branches } = await $`git branch --format=%(refname:short)`
const branchList = branches.split('\n').filter(Boolean)

// Commit
const message = 'feat: add new feature'
await $`git add .`
await $`git commit -m ${message}`
await $`git push`

// Switch branch
const branch = 'develop'
await $`git switch ${branch}`

// Git log
const { stdout: log } = await $`git log --oneline -n 10`
tui.output.log(log)
```

### Docker Operations

```typescript
// Container list
const { stdout } = await $`docker ps --format {{.Names}}`
const containers = stdout.split('\n').filter(Boolean)

// Build image
const imageName = 'my-app'
const tag = 'v1.0.0'
await $`docker build -t ${imageName}:${tag} .`

// Start containers
await $`docker-compose up -d`

// Check logs
const { stdout: logs } = await $`docker logs my-container`
tui.output.log(logs)

// Stop containers
await $`docker-compose down`
```

### File Operations

```typescript
// Create file
const fileName = 'test.txt'
await $`touch ${fileName}`

// Create directory
const dirName = 'my-dir'
await $`mkdir -p ${dirName}`

// Copy file
await $`cp source.txt dest.txt`

// Move file
await $`mv old-name.txt new-name.txt`

// Delete file
await $`rm test.txt`

// Delete directory
await $`rm -rf ${dirName}`

// Check file contents
const { stdout } = await $`cat package.json`
tui.output.log(stdout)
```

### npm/yarn Operations

```typescript
// Package install
const packageName = 'lodash'
await $`npm install ${packageName}`

// Run scripts
await $`npm run build`
await $`npm test`

// Package info
const { stdout } = await $`npm list --depth=0`
tui.output.log(stdout)

// For yarn
await $`yarn add ${packageName}`
await $`yarn build`
```

## Advanced Usage

### Pipeline

```typescript
// Complex command with pipes
const { stdout } = await $`cat package.json | grep version | head -n 1`
tui.output.log(stdout)

// Search with grep
const searchTerm = 'TODO'
const { stdout: searchResult } = await $`grep -r ${searchTerm} src/`
tui.output.log(searchResult)
```

### Conditional Branching

```typescript
// Check file existence
const fileName = 'test.txt'
const { exitCode } = await $`test -f ${fileName}`

if (exitCode === 0) {
  tui.output.log('File exists')
} else {
  tui.output.log('File does not exist')
}

// Check directory existence
const dirName = 'src'
const { exitCode: dirExists } = await $`test -d ${dirName}`

if (dirExists === 0) {
  tui.output.log('Directory exists')
}
```

## Notes

### Security

Variables are automatically escaped, but be careful when executing untrusted user input:

```typescript
// ✅ Safe - variables are auto-escaped
const userInput = "test; rm -rf /"
await $`echo ${userInput}` // "test; rm -rf /" is output as-is

// ❌ Dangerous - don't use string concatenation
await $`echo ${userInput}` // Potential injection attack
```

### Error Handling

`$` does not throw errors. Check `exitCode` to determine the result:

```typescript
const result = await $`nonexistent-command`
if (result.exitCode !== 0) {
  tui.output.error('Command failed:', result.stderr)
}
```

## Options

The shell executor uses Node.js `spawn` internally.

```typescript
// Specify current directory
await $({ cwd: '/path/to/dir' })`ls`

// Add environment variables
await $({ env: { NODE_ENV: 'production' } })`npm run build`

// Set timeout
await $({ timeout: 5000 })`long-running-command`

// Specify shell
await $({ shell: true })`echo $HOME`
```

## Type Definitions

```typescript
interface ShellExecutor {
  (strings: TemplateStringsArray, ...values: unknown[]): Promise<ShellResult>
  (options: ExecaOptions): (strings: TemplateStringsArray, ...values: unknown[]) => Promise<ShellResult>
}

interface ShellResult {
  stdout: string
  stderr: string
  exitCode: number
  command: string
}
```

## References

- [defineAction API](./defineAction.md)
- [prompt API](./prompt.md)
- [Action Creation Tutorial](/en/guides/actions/creating)
